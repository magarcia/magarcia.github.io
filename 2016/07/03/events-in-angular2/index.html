<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8" class="next-head"/><title class="next-head">magarcia</title><link rel="preload" href="/_next/static/4aB80AMth5SkLOF2AzD~K/pages/post.js" as="script"/><link rel="preload" href="/_next/static/4aB80AMth5SkLOF2AzD~K/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/4aB80AMth5SkLOF2AzD~K/pages/_error.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-854838f6492464a6e822.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.96d3ccb2a99a60acf2a6.js" as="script"/><link rel="preload" href="/_next/static/chunks/styles.7d2dab4d8b7bac832de9.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-377bc1082149a53398fc.js" as="script"/><link rel="stylesheet" href="/_next/static/css/styles.4702bfcb.chunk.css"/><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=contain"/><link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i|Open+Sans:600|Playfair+Display:700" rel="stylesheet"/></head><body><div id="__next"><div class="components-___bar___7MxMj"><div class="components-___content___HrAga"><div class="components-___block___9skge"><a href="/"><h1 class="components-___title___1CN1y">magarcia</h1></a></div><div class="components-___block___9skge components-___right___1Sapt"><img alt="Gravatar for newluxfero@gmail.com" src="//www.gravatar.com/avatar/eaf59739836cc2f138c202d05256323d?d=retro&amp;r=g&amp;s=48" srcSet="//www.gravatar.com/avatar/eaf59739836cc2f138c202d05256323d?d=retro&amp;r=g&amp;s=96 2x" height="48" width="48" class="react-gravatar components-___avatar___1cxk3"/></div></div></div><section class="components-___body___1FoQ0"><div class="components-___inner___J7ZR7"><article class="pages-___article___1w_PM"><h1 class="pages-___contentTitle___2LOeo">Events in Angular2</h1><div class="components-___postMetaInline___1GBEP "><time dateTime="1467496800000">Jul 3, 2016</time><span class="components-___middotDivider___yt1kO"></span><span class="components-___readingTime___1s3hq" title="3 min read"></span></div><div class="components-___postContent___3mFwM"><p>During the migration of the feed component, I found a some lines that I didn&#x27;t
know how to code it on Angular 2. The following gist is an extract of the code
I&#x27;m talking about:</p>
<pre><code class="hljs ts" style="display:inline"><span class="hljs-keyword">if</span> (!feed.isLocalScreen) {
  <span class="hljs-comment">// Until this timeout is reached, the &quot;you are muted&quot; notification</span>
  <span class="hljs-comment">// will not be displayed again</span>
  <span class="hljs-keyword">var</span> mutedWarningTimeout = now();

  scope.$on(<span class="hljs-string">&#x27;muted.byRequest&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    mutedWarningTimeout = secondsFromNow(<span class="hljs-number">3</span>);
    MuteNotifier.muted();
  });

  scope.$on(<span class="hljs-string">&#x27;muted.byUser&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">// Reset the warning timeout</span>
    mutedWarningTimeout = now();
  });

  scope.$on(<span class="hljs-string">&#x27;muted.Join&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    mutedWarningTimeout = now();
    MuteNotifier.joinedMuted();
  });

  scope.$watch(<span class="hljs-string">&#x27;vm.feed.isVoiceDetected()&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newVal</span>) </span>{
    <span class="hljs-comment">// Display warning only if muted (check for false, undefined means</span>
    <span class="hljs-comment">// still connecting) and the timeout has been reached</span>
    <span class="hljs-keyword">if</span> (newVal &amp;&amp; feed.getAudioEnabled() === <span class="hljs-literal">false</span> &amp;&amp; now() &gt; mutedWarningTimeout) {
      MuteNotifier.speaking();
      mutedWarningTimeout = secondsFromNow(<span class="hljs-number">60</span>);
    }
  });
}
</code></pre>
<p>As you can see in the snippet, if the condition is true then the directive
listens for events of type <code class="hljs" style="display:inline">muted.byRequest</code>, <code class="hljs" style="display:inline">muted.byUser</code> and <code class="hljs" style="display:inline">muted.Join</code>.
The code that involves this events is easy, without any type of complexity (for
now we ignore the <code class="hljs" style="display:inline">$watch</code>).</p>
<p>But, wait a minute, I have read the documentation of Angular 2 like hundred
times and I do not remember nothing about &quot;events&quot; with Angular 1.X style. Thats
because it not exist. Angular 2 don&#x27;t have a way to make events like in Angular 1,
so I have to find a solution. After search for a solution I found <a href="http://blog.lacolaco.net/post/event-broadcasting-in-angular-2/">this entry</a>
in laco&#x27;s blog.</p>
<h2>Broadcaster</h2>
<p>Basicaly the idea is to make a service that implements the <code class="hljs" style="display:inline">$broadcast</code> and
<code class="hljs" style="display:inline">$on</code> method like we had in <code class="hljs" style="display:inline">$rootScope</code>. For do this we use Observables, very
important in Angular 2, and in this case we use a <a href="https://github.com/Reactive-Extensions/RxJS/blob/master/doc/gettingstarted/subjects.md">Subject</a>.</p>
<pre><code class="hljs ts" style="display:inline"><span class="hljs-keyword">import</span> { Subject } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;rxjs/Subject&#x27;</span>;
<span class="hljs-keyword">import</span> { Observable } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;rxjs/Observable&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;rxjs/add/operator/filter&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;rxjs/add/operator/map&#x27;</span>;

<span class="hljs-keyword">interface</span> BroadcastEvent {
  key: <span class="hljs-built_in">any</span>;
  data?: <span class="hljs-built_in">any</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> Broadcaster {
  <span class="hljs-keyword">private</span> _eventBus: Subject&lt;BroadcastEvent&gt;;

  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">this</span>._eventBus = <span class="hljs-keyword">new</span> Subject&lt;BroadcastEvent&gt;();
  }

  broadcast(key: <span class="hljs-built_in">any</span>, data?: <span class="hljs-built_in">any</span>) {
    <span class="hljs-keyword">this</span>._eventBus.next({ key, data });
  }

  on&lt;T&gt;(key: <span class="hljs-built_in">any</span>): Observable&lt;T&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._eventBus
      .asObservable()
      .filter(<span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> event.key === key)
      .map(<span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> &lt;T&gt;event.data);
  }
}
</code></pre>
<p>So, now we can start to use events like in the example:</p>
<pre><code class="hljs ts" style="display:inline"><span class="hljs-comment">// child.ts</span>
<span class="hljs-meta">@Component</span>({
    selector: <span class="hljs-string">&#x27;child&#x27;</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> ChildComponent {
  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> broadcaster: Broadcaster</span>) {
  }

  registerStringBroadcast() {
    <span class="hljs-keyword">this</span>.broadcaster.on&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">&#x27;MyEvent&#x27;</span>)
      .subscribe(<span class="hljs-function"><span class="hljs-params">message</span> =&gt;</span> {
        ...
      });
  }

  emitStringBroadcast() {
    <span class="hljs-keyword">this</span>.broadcaster.broadcast(<span class="hljs-string">&#x27;MyEvent&#x27;</span>, <span class="hljs-string">&#x27;some message&#x27;</span>);
  }
}
</code></pre>
<h2>How I solved the problem?</h2>
<p>I didn&#x27;t. This events are only to show the user information pop ups about when
he is muted, so it&#x27;s not a critical feature. By now this events are fired and
listen in different components, and some of it still implemented in Angular 1.4.</p>
<p>This is a solution I want to share with you, but I&#x27;m not sure if this will be
the way that I will use to solve the problem. Because this events probably won&#x27;t
be necessary when I reimplement the <code class="hljs" style="display:inline">MuteNotifier</code>.</p></div></article><aside class="components-___aside___LIh0t  components-___ssrAnimation___1cKKV"><a title="Share on Twitter" aria-label="Share on Twitter" target="_blank" rel="noopener noreferrer" href="https://twitter.com/intent/tweet?text=Events in Angular2&amp;url=https://magarcia.github.io/2016/7/3/events-in-angular2&amp;via=martinprins"><svg width="20" height="20" viewBox="0 0 24 24"><path d="M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z"></path></svg></a><a title="Share on Facebook" aria-label="Share on Facebook" target="_blank" rel="noopener noreferrer" href="https://www.facebook.com/sharer/sharer.php?u=https://magarcia.github.io/2016/7/3/events-in-angular2"><svg width="20" height="20" viewBox="0 0 24 24"><path d="M22.676 0H1.324C.593 0 0 .593 0 1.324v21.352C0 23.408.593 24 1.324 24h11.494v-9.294H9.689v-3.621h3.129V8.41c0-3.099 1.894-4.785 4.659-4.785 1.325 0 2.464.097 2.796.141v3.24h-1.921c-1.5 0-1.792.721-1.792 1.771v2.311h3.584l-.465 3.63H16.56V24h6.115c.733 0 1.325-.592 1.325-1.324V1.324C24 .593 23.408 0 22.676 0"></path></svg></a><a title="Share on LinkedIn" aria-label="Share on LinkedIn" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://magarcia.github.io/2016/7/3/events-in-angular2&amp;title=Events in Angular2&amp;source=https%3A//www.linkedin.com/in/martingarciamonterde/"><svg width="20" height="20" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a></aside></div></section><div class="components-___footer___229iY"><div class="components-___footerContent___3zrKr"><span>Made with<!-- --> <span role="img" aria-label="love">❤️</span> <!-- -->from Barcelona</span></div></div></div><script>__NEXT_DATA__ = {"props":{"pageProps":{"slug":"events-in-angular2","year":2016,"month":7,"day":3,"content":"\nDuring the migration of the feed component, I found a some lines that I didn't\nknow how to code it on Angular 2. The following gist is an extract of the code\nI'm talking about:\n\n```ts\nif (!feed.isLocalScreen) {\n  // Until this timeout is reached, the \"you are muted\" notification\n  // will not be displayed again\n  var mutedWarningTimeout = now();\n\n  scope.$on('muted.byRequest', function() {\n    mutedWarningTimeout = secondsFromNow(3);\n    MuteNotifier.muted();\n  });\n\n  scope.$on('muted.byUser', function() {\n    // Reset the warning timeout\n    mutedWarningTimeout = now();\n  });\n\n  scope.$on('muted.Join', function() {\n    mutedWarningTimeout = now();\n    MuteNotifier.joinedMuted();\n  });\n\n  scope.$watch('vm.feed.isVoiceDetected()', function(newVal) {\n    // Display warning only if muted (check for false, undefined means\n    // still connecting) and the timeout has been reached\n    if (newVal \u0026\u0026 feed.getAudioEnabled() === false \u0026\u0026 now() \u003e mutedWarningTimeout) {\n      MuteNotifier.speaking();\n      mutedWarningTimeout = secondsFromNow(60);\n    }\n  });\n}\n```\n\nAs you can see in the snippet, if the condition is true then the directive\nlistens for events of type `muted.byRequest`, `muted.byUser` and `muted.Join`.\nThe code that involves this events is easy, without any type of complexity (for\nnow we ignore the `$watch`).\n\nBut, wait a minute, I have read the documentation of Angular 2 like hundred\ntimes and I do not remember nothing about \"events\" with Angular 1.X style. Thats\nbecause it not exist. Angular 2 don't have a way to make events like in Angular 1,\nso I have to find a solution. After search for a solution I found [this entry](http://blog.lacolaco.net/post/event-broadcasting-in-angular-2/)\nin laco's blog.\n\n## Broadcaster\n\nBasicaly the idea is to make a service that implements the `$broadcast` and\n`$on` method like we had in `$rootScope`. For do this we use Observables, very\nimportant in Angular 2, and in this case we use a [Subject](https://github.com/Reactive-Extensions/RxJS/blob/master/doc/gettingstarted/subjects.md).\n\n```ts\nimport { Subject } from 'rxjs/Subject';\nimport { Observable } from 'rxjs/Observable';\nimport 'rxjs/add/operator/filter';\nimport 'rxjs/add/operator/map';\n\ninterface BroadcastEvent {\n  key: any;\n  data?: any;\n}\n\nexport class Broadcaster {\n  private _eventBus: Subject\u003cBroadcastEvent\u003e;\n\n  constructor() {\n    this._eventBus = new Subject\u003cBroadcastEvent\u003e();\n  }\n\n  broadcast(key: any, data?: any) {\n    this._eventBus.next({ key, data });\n  }\n\n  on\u003cT\u003e(key: any): Observable\u003cT\u003e {\n    return this._eventBus\n      .asObservable()\n      .filter(event =\u003e event.key === key)\n      .map(event =\u003e \u003cT\u003eevent.data);\n  }\n}\n```\n\nSo, now we can start to use events like in the example:\n\n```ts\n// child.ts\n@Component({\n    selector: 'child'\n})\nexport class ChildComponent {\n  constructor(private broadcaster: Broadcaster) {\n  }\n\n  registerStringBroadcast() {\n    this.broadcaster.on\u003cstring\u003e('MyEvent')\n      .subscribe(message =\u003e {\n        ...\n      });\n  }\n\n  emitStringBroadcast() {\n    this.broadcaster.broadcast('MyEvent', 'some message');\n  }\n}\n```\n\n## How I solved the problem?\n\nI didn't. This events are only to show the user information pop ups about when\nhe is muted, so it's not a critical feature. By now this events are fired and\nlisten in different components, and some of it still implemented in Angular 1.4.\n\nThis is a solution I want to share with you, but I'm not sure if this will be\nthe way that I will use to solve the problem. Because this events probably won't\nbe necessary when I reimplement the `MuteNotifier`.\n","readingTime":"3 min read","title":"Events in Angular2"}},"page":"/post","query":{"year":"2016","month":"07","day":"03","id":"events-in-angular2"},"buildId":"4aB80AMth5SkLOF2AzD~K","nextExport":true};__NEXT_LOADED_PAGES__=[];__NEXT_REGISTER_PAGE=function(r,f){__NEXT_LOADED_PAGES__.push([r, f])}</script><script async="" id="__NEXT_PAGE__/post" src="/_next/static/4aB80AMth5SkLOF2AzD~K/pages/post.js"></script><script async="" id="__NEXT_PAGE__/_app" src="/_next/static/4aB80AMth5SkLOF2AzD~K/pages/_app.js"></script><script async="" id="__NEXT_PAGE__/_error" src="/_next/static/4aB80AMth5SkLOF2AzD~K/pages/_error.js"></script><script src="/_next/static/runtime/webpack-854838f6492464a6e822.js" async=""></script><script src="/_next/static/chunks/commons.96d3ccb2a99a60acf2a6.js" async=""></script><script src="/_next/static/chunks/styles.7d2dab4d8b7bac832de9.js" async=""></script><script src="/_next/static/runtime/main-377bc1082149a53398fc.js" async=""></script></body></html>