<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8" class="next-head"/><title class="next-head">magarcia</title><link rel="preload" href="/_next/static/4aB80AMth5SkLOF2AzD~K/pages/post.js" as="script"/><link rel="preload" href="/_next/static/4aB80AMth5SkLOF2AzD~K/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/4aB80AMth5SkLOF2AzD~K/pages/_error.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-854838f6492464a6e822.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.96d3ccb2a99a60acf2a6.js" as="script"/><link rel="preload" href="/_next/static/chunks/styles.7d2dab4d8b7bac832de9.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-377bc1082149a53398fc.js" as="script"/><link rel="stylesheet" href="/_next/static/css/styles.4702bfcb.chunk.css"/><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=contain"/><link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i|Open+Sans:600|Playfair+Display:700" rel="stylesheet"/></head><body><div id="__next"><div class="components-___bar___7MxMj"><div class="components-___content___HrAga"><div class="components-___block___9skge"><a href="/"><h1 class="components-___title___1CN1y">magarcia</h1></a></div><div class="components-___block___9skge components-___right___1Sapt"><img alt="Gravatar for newluxfero@gmail.com" src="//www.gravatar.com/avatar/eaf59739836cc2f138c202d05256323d?d=retro&amp;r=g&amp;s=48" srcSet="//www.gravatar.com/avatar/eaf59739836cc2f138c202d05256323d?d=retro&amp;r=g&amp;s=96 2x" height="48" width="48" class="react-gravatar components-___avatar___1cxk3"/></div></div></div><section class="components-___body___1FoQ0"><div class="components-___inner___J7ZR7"><article class="pages-___article___1w_PM"><h1 class="pages-___contentTitle___2LOeo">Moving big parts to Angular 2</h1><div class="components-___postMetaInline___1GBEP "><time dateTime="1465682400000">Jun 12, 2016</time><span class="components-___middotDivider___yt1kO"></span><span class="components-___readingTime___1s3hq" title="6 min read"></span></div><div class="components-___postContent___3mFwM"><p>In previous post I explained how I convert Jangouts to an hybrid Angular 1+2
application. This approach, instead of a full migration, has two objectives. In
first place test that the functionalities are working correctly is more easy,
because it&#x27;s possible to run Jangouts and use it. And on the other hand, if I
can&#x27;t finish the migration, the application will be still usable allowing others
to continue the work. But I hope this last scenario won&#x27;t be real.</p>
<p>With the hybrid approach applied, this week I have been working on migrate some
components to Angular 2. I started migrating the Chat component, more complex
than the Footer previously migrated, but not enough to be frustrating in these
early stages.</p>
<h2>Migrating subcomponents</h2>
<p>The Chat component of Jangouts has three subcomponents, a part of the main
component:</p>
<ul>
<li><strong><code class="hljs" style="display:inline">chat-message</code></strong>: That handles the render the message sent by the user.</li>
<li><strong><code class="hljs" style="display:inline">log-entry</code></strong>: That handles the notifications sent by the system (like &quot;<em>The user
X has joined</em>).</li>
<li><strong><code class="hljs" style="display:inline">chat-form</code></strong>: That handles the input of messages.</li>
</ul>
<p>These subcomponents are really simple, each one has a component class without
much code and a template. But the key of this migration has been that the styles
was moved from the main <code class="hljs" style="display:inline">scss</code> file to independent files for each subcomponent.
This take profit of <a href="https://angular.io/docs/ts/latest/guide/component-styles.html#!#view-encapsulation">Angular 2 View Encapsulation</a>,
ensuring that the styles will be only applied to the component.</p>
<p>During the <code class="hljs" style="display:inline">chat-message</code> migration I found a trouble. A problem that comes
from the sue of <a href="https://github.com/ritz078/ng-embed">ngEmbed</a> library that
provides a directive for render the user messages. This directive allows the
users to use emojis and embed links, images, videos, etc. But as expected the
library hasn&#x27;t support for Angular 2, so I tried to upgrade the directive with
the <a href="https://angular.io/docs/ts/latest/guide/upgrade.html#!#how-the-upgrade-adapter-works">Angular 2 Upgrade Adapter</a>
but I found an strange error.</p>
<p>After some investigation, I found that ngEmbed use a function as <code class="hljs" style="display:inline">templateUrl</code>
attribute (which is allowed in Angular 1), but in the version of Angular 2 that
I&#x27;m currently using with the project, the upgrade adapter don&#x27;t support this
kind of <code class="hljs" style="display:inline">templateUrl</code>. I saw in the master branch of Angular 2 that the code
has been updated to support this functionality, but now neither version
incorporates the change. So after discuss with my mentors we decide to disable
this functionality in Jangouts and keep moving with the migration.</p>
<p>I wish have time to reenable it in the future.</p>
<h2>Differentiate between component and directive</h2>
<p>Migrate the main component was more complex. The main component has the list of
all messages (user and system messages) in a view that auto scroll when a new
message arrives. In the old Jangouts, this was one directive that renders the
list of messages and control the auto scroll. But Angular 2 is a different
paradigm. In Angular 2, the correct approach, a component always have a template
and never interacts with the DOM and a directive never have a template and can
interact with the DOM.</p>
<p>So this evidence that the main chat component would be migrated into two
different things:</p>
<ul>
<li>A <strong>component</strong> to render the list of messages.</li>
<li>A <strong>directive</strong> that auto scroll when it&#x27;s necessary.</li>
</ul>
<p>After the migration we have the component that renders the list of messages and
inside it the directive that handles the auto scroll.</p>
<h2>Putting all together</h2>
<p>During the subcomponents migration, each one was downgraded to be Angular 1
compatible using the provided adapter by Angular 2 and manually tested with the
old version of the main component. When the main component was migrated, this
made that the code of the component was pure Angular 2 (without downgrade the
subcomponents) and the only thing to do to keep the compatibility with the rest
of the Angular 1 application was downgrade the main chat component.</p>
<h2>Applying the correct application structure</h2>
<p>The changes applied this week wasn&#x27;t only in the code, I also update the
application structure following the recommendations of the <a href="https://angular.io/styleguide#!#application-structure_">style guide</a>.
Previous to the migration the application has the following structure:</p>
<pre><code class="hljs" style="display:inline">src
└── app
    ├── adapter.ts
    ├── variables.scss
    ├── index.scss
    ├── vendor.scss
    ├── index.ts
    ├── components
    │   ├── chat
    │   │   ├── chat-form.directive.html
    │   │   ├── chat-form.directive.js
    │   │   ├── chat.directive.html
    │   │   ├── chat.directive.js
    │   │   ├── chat-message.directive.html
    │   │   ├── chat-message.directive.js
    │   │   ├── log-entry.directive.html
    │   │   └── log-entry.directive.html
    │   ├── footer
    │   │   ├── footer.directive.html
    │   │   └── footer.directive.js
    │   └── [...]
    └── [...]
</code></pre>
<p>But after the changes this is the result:</p>
<pre><code class="hljs ts" style="display:inline">src
└── app
    ├── adapter.ts
    ├── variables.scss
    ├── index.scss
    ├── vendor.scss
    ├── index.ts
    ├── chat
    │   ├── index.ts
    │   ├── chat.component.html
    │   ├── chat.component.scss
    │   ├── chat.component.spec.ts
    │   ├── chat.component.ts
    │   ├── chat-form
    │   │   ├── chat-form.component.html
    │   │   ├── chat-form.component.spec.ts
    │   │   ├── chat-form.component.ts
    │   │   └── index.ts
    │   ├── chat-message
    │   │   ├── chat-message.component.html
    │   │   ├── chat-message.component.scss
    │   │   ├── chat-message.component.spec.ts
    │   │   ├── chat-message.component.ts
    │   │   └── index.ts
    │   ├── log-entry
    │   │   ├── index.ts
    │   │   ├── log-entry.component.html
    │   │   ├── log-entry.component.spec.ts
    │   │   └── log-entry.component.ts
    │   └── message-autoscroll.directive.ts
    ├── footer
    │   ├── footer.component.html
    │   ├── footer.component.scss
    │   ├── footer.component.spec.ts
    │   ├── footer.component.ts
    │   └── index.ts
    ├── components
    │   └──  [...] <span class="hljs-comment">// This contains the not migrated code</span>
    └── [...]
</code></pre>
<h2>Currently working</h2>
<p>Currently I&#x27;m working on the migration of Feed component. This is one of the
most complex components in the application because it has a lot of services that
handles the video/audio streams.</p>
<p>Actually I&#x27;ve moved all the services and factories to Angular 2 services, but I
still not enabled the support for work with the Angular 1 code. The reason? I
want to make a full testsuite that tests this services deeply before to continue
with the migration of the rest of the component and make the integration with
the rest of the application.</p></div></article><aside class="components-___aside___LIh0t  components-___ssrAnimation___1cKKV"><a title="Share on Twitter" aria-label="Share on Twitter" target="_blank" rel="noopener noreferrer" href="https://twitter.com/intent/tweet?text=Moving big parts to Angular 2&amp;url=https://magarcia.github.io/2016/6/12/moving-big-parts-to-angular-2&amp;via=martinprins"><svg width="20" height="20" viewBox="0 0 24 24"><path d="M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z"></path></svg></a><a title="Share on Facebook" aria-label="Share on Facebook" target="_blank" rel="noopener noreferrer" href="https://www.facebook.com/sharer/sharer.php?u=https://magarcia.github.io/2016/6/12/moving-big-parts-to-angular-2"><svg width="20" height="20" viewBox="0 0 24 24"><path d="M22.676 0H1.324C.593 0 0 .593 0 1.324v21.352C0 23.408.593 24 1.324 24h11.494v-9.294H9.689v-3.621h3.129V8.41c0-3.099 1.894-4.785 4.659-4.785 1.325 0 2.464.097 2.796.141v3.24h-1.921c-1.5 0-1.792.721-1.792 1.771v2.311h3.584l-.465 3.63H16.56V24h6.115c.733 0 1.325-.592 1.325-1.324V1.324C24 .593 23.408 0 22.676 0"></path></svg></a><a title="Share on LinkedIn" aria-label="Share on LinkedIn" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://magarcia.github.io/2016/6/12/moving-big-parts-to-angular-2&amp;title=Moving big parts to Angular 2&amp;source=https%3A//www.linkedin.com/in/martingarciamonterde/"><svg width="20" height="20" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a></aside></div></section><div class="components-___footer___229iY"><div class="components-___footerContent___3zrKr"><span>Made with<!-- --> <span role="img" aria-label="love">❤️</span> <!-- -->from Barcelona</span></div></div></div><script>__NEXT_DATA__ = {"props":{"pageProps":{"slug":"moving-big-parts-to-angular-2","year":2016,"month":6,"day":12,"content":"\nIn previous post I explained how I convert Jangouts to an hybrid Angular 1+2\napplication. This approach, instead of a full migration, has two objectives. In\nfirst place test that the functionalities are working correctly is more easy,\nbecause it's possible to run Jangouts and use it. And on the other hand, if I\ncan't finish the migration, the application will be still usable allowing others\nto continue the work. But I hope this last scenario won't be real.\n\nWith the hybrid approach applied, this week I have been working on migrate some\ncomponents to Angular 2. I started migrating the Chat component, more complex\nthan the Footer previously migrated, but not enough to be frustrating in these\nearly stages.\n\n## Migrating subcomponents\n\nThe Chat component of Jangouts has three subcomponents, a part of the main\ncomponent:\n\n- **`chat-message`**: That handles the render the message sent by the user.\n- **`log-entry`**: That handles the notifications sent by the system (like \"*The user\nX has joined*).\n- **`chat-form`**: That handles the input of messages.\n\nThese subcomponents are really simple, each one has a component class without\nmuch code and a template. But the key of this migration has been that the styles\nwas moved from the main `scss` file to independent files for each subcomponent.\nThis take profit of [Angular 2 View Encapsulation](https://angular.io/docs/ts/latest/guide/component-styles.html#!#view-encapsulation),\nensuring that the styles will be only applied to the component.\n\nDuring the `chat-message` migration I found a trouble. A problem that comes\nfrom the sue of [ngEmbed](https://github.com/ritz078/ng-embed) library that\nprovides a directive for render the user messages. This directive allows the\nusers to use emojis and embed links, images, videos, etc. But as expected the\nlibrary hasn't support for Angular 2, so I tried to upgrade the directive with\nthe [Angular 2 Upgrade Adapter](https://angular.io/docs/ts/latest/guide/upgrade.html#!#how-the-upgrade-adapter-works)\nbut I found an strange error.\n\nAfter some investigation, I found that ngEmbed use a function as `templateUrl`\nattribute (which is allowed in Angular 1), but in the version of Angular 2 that\nI'm currently using with the project, the upgrade adapter don't support this\nkind of `templateUrl`. I saw in the master branch of Angular 2 that the code\nhas been updated to support this functionality, but now neither version\nincorporates the change. So after discuss with my mentors we decide to disable\nthis functionality in Jangouts and keep moving with the migration.\n\nI wish have time to reenable it in the future.\n\n## Differentiate between component and directive\n\nMigrate the main component was more complex. The main component has the list of\nall messages (user and system messages) in a view that auto scroll when a new\nmessage arrives. In the old Jangouts, this was one directive that renders the\nlist of messages and control the auto scroll. But Angular 2 is a different\nparadigm. In Angular 2, the correct approach, a component always have a template\nand never interacts with the DOM and a directive never have a template and can\ninteract with the DOM.\n\nSo this evidence that the main chat component would be migrated into two\ndifferent things:\n\n- A **component** to render the list of messages.\n- A **directive** that auto scroll when it's necessary.\n\nAfter the migration we have the component that renders the list of messages and\ninside it the directive that handles the auto scroll.\n\n## Putting all together\n\nDuring the subcomponents migration, each one was downgraded to be Angular 1\ncompatible using the provided adapter by Angular 2 and manually tested with the\nold version of the main component. When the main component was migrated, this\nmade that the code of the component was pure Angular 2 (without downgrade the\nsubcomponents) and the only thing to do to keep the compatibility with the rest\nof the Angular 1 application was downgrade the main chat component.\n\n## Applying the correct application structure\n\nThe changes applied this week wasn't only in the code, I also update the\napplication structure following the recommendations of the [style guide](https://angular.io/styleguide#!#application-structure_).\nPrevious to the migration the application has the following structure:\n\n```\nsrc\n└── app\n    ├── adapter.ts\n    ├── variables.scss\n    ├── index.scss\n    ├── vendor.scss\n    ├── index.ts\n    ├── components\n    │   ├── chat\n    │   │   ├── chat-form.directive.html\n    │   │   ├── chat-form.directive.js\n    │   │   ├── chat.directive.html\n    │   │   ├── chat.directive.js\n    │   │   ├── chat-message.directive.html\n    │   │   ├── chat-message.directive.js\n    │   │   ├── log-entry.directive.html\n    │   │   └── log-entry.directive.html\n    │   ├── footer\n    │   │   ├── footer.directive.html\n    │   │   └── footer.directive.js\n    │   └── [...]\n    └── [...]\n```\n\nBut after the changes this is the result:\n\n```\nsrc\n└── app\n    ├── adapter.ts\n    ├── variables.scss\n    ├── index.scss\n    ├── vendor.scss\n    ├── index.ts\n    ├── chat\n    │   ├── index.ts\n    │   ├── chat.component.html\n    │   ├── chat.component.scss\n    │   ├── chat.component.spec.ts\n    │   ├── chat.component.ts\n    │   ├── chat-form\n    │   │   ├── chat-form.component.html\n    │   │   ├── chat-form.component.spec.ts\n    │   │   ├── chat-form.component.ts\n    │   │   └── index.ts\n    │   ├── chat-message\n    │   │   ├── chat-message.component.html\n    │   │   ├── chat-message.component.scss\n    │   │   ├── chat-message.component.spec.ts\n    │   │   ├── chat-message.component.ts\n    │   │   └── index.ts\n    │   ├── log-entry\n    │   │   ├── index.ts\n    │   │   ├── log-entry.component.html\n    │   │   ├── log-entry.component.spec.ts\n    │   │   └── log-entry.component.ts\n    │   └── message-autoscroll.directive.ts\n    ├── footer\n    │   ├── footer.component.html\n    │   ├── footer.component.scss\n    │   ├── footer.component.spec.ts\n    │   ├── footer.component.ts\n    │   └── index.ts\n    ├── components\n    │   └──  [...] // This contains the not migrated code\n    └── [...]\n```\n\n## Currently working\n\nCurrently I'm working on the migration of Feed component. This is one of the\nmost complex components in the application because it has a lot of services that\nhandles the video/audio streams.\n\nActually I've moved all the services and factories to Angular 2 services, but I\nstill not enabled the support for work with the Angular 1 code. The reason? I\nwant to make a full testsuite that tests this services deeply before to continue\nwith the migration of the rest of the component and make the integration with\nthe rest of the application.\n\n\n","readingTime":"6 min read","title":"Moving big parts to Angular 2"}},"page":"/post","query":{"year":"2016","month":"06","day":"12","id":"moving-big-parts-to-angular-2"},"buildId":"4aB80AMth5SkLOF2AzD~K","nextExport":true};__NEXT_LOADED_PAGES__=[];__NEXT_REGISTER_PAGE=function(r,f){__NEXT_LOADED_PAGES__.push([r, f])}</script><script async="" id="__NEXT_PAGE__/post" src="/_next/static/4aB80AMth5SkLOF2AzD~K/pages/post.js"></script><script async="" id="__NEXT_PAGE__/_app" src="/_next/static/4aB80AMth5SkLOF2AzD~K/pages/_app.js"></script><script async="" id="__NEXT_PAGE__/_error" src="/_next/static/4aB80AMth5SkLOF2AzD~K/pages/_error.js"></script><script src="/_next/static/runtime/webpack-854838f6492464a6e822.js" async=""></script><script src="/_next/static/chunks/commons.96d3ccb2a99a60acf2a6.js" async=""></script><script src="/_next/static/chunks/styles.7d2dab4d8b7bac832de9.js" async=""></script><script src="/_next/static/runtime/main-377bc1082149a53398fc.js" async=""></script></body></html>