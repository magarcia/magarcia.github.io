{"data":{"site":{"siteMetadata":{"title":"magarcia","author":"Martin Garcia"}},"markdownRemark":{"id":"2c6e4213-fd60-5c57-b300-9f6ee78e7484","html":"<p>In a previous post I explained how I convert Jangouts to a hybrid Angular 1+2\napplication. This approach, instead of a full migration, has two objectives. In\nfirst place test that the functionalities are working correctly is more easy,\nbecause it’s possible to run Jangouts and use it. And on the other hand, if I\ncan’t finish the migration, the application will be still usable allowing others\nto continue the work. But I hope this last scenario won’t be real.</p>\n<p>With the hybrid approach applied, this week I have been working on migrating some\ncomponents to Angular 2. I started migrating the Chat component, more complex\nthan the Footer previously migrated, but not enough to be frustrating in these\nearly stages.</p>\n<h2 id=\"migrating-subcomponents\"><a href=\"#migrating-subcomponents\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Migrating subcomponents</h2>\n<p>The Chat component of Jangouts has three subcomponents, a part of the main\ncomponent:</p>\n<ul>\n<li><strong><code class=\"language-text\">chat-message</code></strong>: That handles the render the message sent by the user.</li>\n<li><strong><code class=\"language-text\">log-entry</code></strong>: That handles the notifications sent by the system (like ”<em>The user\nX has joined</em>).</li>\n<li><strong><code class=\"language-text\">chat-form</code></strong>: That handles the input of messages.</li>\n</ul>\n<p>These subcomponents are really simple, each one has a component class without\nmuch code and a template. But the key of this migration has been that the styles\nwere moved from the main <code class=\"language-text\">scss</code> file to independent files for each subcomponent.\nThis takes profit of <a href=\"https://angular.io/docs/ts/latest/guide/component-styles.html#!#view-encapsulation\">Angular 2 View Encapsulation</a>,\nensuring that the styles will be only applied to the component.</p>\n<p>During the <code class=\"language-text\">chat-message</code> migration, I found trouble. A problem that comes\nfrom the sue of <a href=\"https://github.com/ritz078/ng-embed\">ngEmbed</a> library that\nprovides a directive to render the user messages. This directive allows users\nto use emojis and embed links, images, videos, etc. But as expected the\nlibrary hasn’t support for Angular 2, so I tried to upgrade the directive with\nthe <a href=\"https://angular.io/docs/ts/latest/guide/upgrade.html#!#how-the-upgrade-adapter-works\">Angular 2 Upgrade Adapter</a>\nbut I found a strange error.</p>\n<p>After some investigation, I found that ngEmbed use a function as <code class=\"language-text\">templateUrl</code>\nattribute (which is allowed in Angular 1), but in the version of Angular 2 that\nI’m currently using with the project, the upgrade adapter don’t support this\nkind of <code class=\"language-text\">templateUrl</code>. I saw in the master branch of Angular 2 that the code\nhas been updated to support this functionality, but now neither version\nincorporates the change. So after discussing with my mentors, we decide to disable\nthis functionality in Jangouts and keep moving with the migration.</p>\n<p>I wish to have time to reenable it in the future.</p>\n<h2 id=\"differentiate-between-component-and-directive\"><a href=\"#differentiate-between-component-and-directive\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Differentiate between component and directive</h2>\n<p>Migrate the main component was more complex. The main component has the list of\nall messages (user and system messages) in a view that auto scroll when a new\nmessage arrives. In the old Jangouts, this was one directive that renders the\nlist of messages and controls the auto scroll. But Angular 2 is a different\nparadigm. In Angular 2, the correct approach, a component always have a template\nand never interacts with the DOM and a directive never have a template and can\ninteract with the DOM.</p>\n<p>So this evidence that the main chat component would be migrated into two\ndifferent things:</p>\n<ul>\n<li>A <strong>component</strong> to render the list of messages.</li>\n<li>A <strong>directive</strong> that auto scroll when it’s necessary.</li>\n</ul>\n<p>After the migration, we have the component that renders the list of messages and\ninside it the directive that handles the auto scroll.</p>\n<h2 id=\"putting-all-together\"><a href=\"#putting-all-together\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Putting all together</h2>\n<p>During the subcomponents migration, each one was downgraded to be Angular 1\ncompatible using the provided adapter by Angular 2 and manually tested with the\nold version of the main component. When the main component was migrated, this\nmade that the code of the component was pure Angular 2 (without downgrade the\nsubcomponents) and the only thing to do to keep the compatibility with the rest\nof the Angular 1 application was downgrade the main chat component.</p>\n<h2 id=\"applying-the-correct-application-structure\"><a href=\"#applying-the-correct-application-structure\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Applying the correct application structure</h2>\n<p>The changes applied this week wasn’t only in the code, I also update the\napplication structure following the recommendations of the <a href=\"https://angular.io/styleguide#!#application-structure_\">style guide</a>.\nPrevious to the migration the application has the following structure:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">src\n└── app\n    ├── adapter.ts\n    ├── variables.scss\n    ├── index.scss\n    ├── vendor.scss\n    ├── index.ts\n    ├── components\n    │   ├── chat\n    │   │   ├── chat-form.directive.html\n    │   │   ├── chat-form.directive.js\n    │   │   ├── chat.directive.html\n    │   │   ├── chat.directive.js\n    │   │   ├── chat-message.directive.html\n    │   │   ├── chat-message.directive.js\n    │   │   ├── log-entry.directive.html\n    │   │   └── log-entry.directive.html\n    │   ├── footer\n    │   │   ├── footer.directive.html\n    │   │   └── footer.directive.js\n    │   └── [...]\n    └── [...]</code></pre></div>\n<p>But after the changes this is the result:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">src\n└── app\n    ├── adapter.ts\n    ├── variables.scss\n    ├── index.scss\n    ├── vendor.scss\n    ├── index.ts\n    ├── chat\n    │   ├── index.ts\n    │   ├── chat.component.html\n    │   ├── chat.component.scss\n    │   ├── chat.component.spec.ts\n    │   ├── chat.component.ts\n    │   ├── chat-form\n    │   │   ├── chat-form.component.html\n    │   │   ├── chat-form.component.spec.ts\n    │   │   ├── chat-form.component.ts\n    │   │   └── index.ts\n    │   ├── chat-message\n    │   │   ├── chat-message.component.html\n    │   │   ├── chat-message.component.scss\n    │   │   ├── chat-message.component.spec.ts\n    │   │   ├── chat-message.component.ts\n    │   │   └── index.ts\n    │   ├── log-entry\n    │   │   ├── index.ts\n    │   │   ├── log-entry.component.html\n    │   │   ├── log-entry.component.spec.ts\n    │   │   └── log-entry.component.ts\n    │   └── message-autoscroll.directive.ts\n    ├── footer\n    │   ├── footer.component.html\n    │   ├── footer.component.scss\n    │   ├── footer.component.spec.ts\n    │   ├── footer.component.ts\n    │   └── index.ts\n    ├── components\n    │   └──  [...] // This contains the not migrated code\n    └── [...]</code></pre></div>\n<h2 id=\"currently-working\"><a href=\"#currently-working\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Currently working</h2>\n<p>Currently I’m working on the migration of Feed component. This is one of the\nmost complex components in the application because it has a lot of services that\nhandles the video/audio streams.</p>\n<p>Actually, I’ve moved all the services and factories to Angular 2 services, but I\nstill not enabled the support for work with the Angular 1 code. The reason? I\nwant to make a full test suite that tests these services deeply before to continue\nwith the migration of the rest of the component and make the integration with\nthe rest of the application.</p>","timeToRead":5,"frontmatter":{"title":"Moving big parts to Angular 2","date":"June 12, 2016","dateRaw":"2016-06-12","spoiler":null},"fields":{"slug":"/moving-big-parts-to-angular-2/"}}},"pageContext":{"slug":"/moving-big-parts-to-angular-2/","date":"2016-06-12","previous":{"fields":{"slug":"/component-migration-started/","directoryName":"component-migration-started"},"frontmatter":{"title":"Components migration started","date":"2016-06-05"}},"next":{"fields":{"slug":"/angularbeers-with-misko-hevery/","directoryName":"angularbeers-with-misko-hevery"},"frontmatter":{"title":"AngularBeers with Miško Hevery","date":"2016-06-26"}}}}